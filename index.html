<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>九九乘法表配對遊戲</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        h1 {
            background-color: #4CAF50;
            color: white;
            padding: 20px 0;
            margin: 0;
        }

        p {
            font-size: 18px;
            margin: 10px 0;
        }

        #timer, #best-time {
            font-size: 20px;
            margin-top: 10px;
        }

        #game-container {
            width: 80%;
            margin: 20px auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .card {
            width: 120px;
            height: 80px;
            background-color: #fff;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 10px;
            user-select: none;
            border: 2px solid #4CAF50;
            margin: 10px;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: scale(1.05);
            background-color: #e8f5e9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .selected {
            background-color: #FFECB3;
        }

        .matched {
            background-color: #A5D6A7;
            cursor: default;
            visibility: hidden;
        }

        /* 音效控制 */
        audio {
            display: none;
        }

        /* 手機響應式 */
        @media (max-width: 768px) {
            #game-container {
                width: 100%;
            }

            .card {
                width: 100px;
                height: 70px;
                margin: 8px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>

<h1>九九乘法表配對遊戲</h1>
<p>將乘法算式與正確的答案配對。</p>
<div id="timer">時間：<span id="time">0</span> 秒</div>
<div id="best-time">最佳時間：<span id="best">--</span> 秒</div>
<div id="game-container"></div>

<!-- 音效檔案 -->
<audio id="correct-sound" src="correct.mp3"></audio>
<audio id="wrong-sound" src="wrong.mp3"></audio>

<script>
    let selectedCards = [];
    const gameContainer = document.getElementById('game-container');
    let startTime, timerInterval;
    let bestTime = localStorage.getItem('bestTime') || '--';

    document.getElementById('best').textContent = bestTime;

    // 生成乘法算式與答案
    function generateCards() {
        const expressions = [];
        const answers = [];
        const usedPairs = new Set();
        const totalPairs = 20; // 增加配對組數

        while (expressions.length < totalPairs) {
            const a = Math.floor(Math.random() * 9) + 1;
            const b = Math.floor(Math.random() * 9) + 1;
            const result = a * b;
            const pairKey = `${a}x${b}`;

            // 避免重複的算式
            if (!usedPairs.has(pairKey)) {
                usedPairs.add(pairKey);
                expressions.push({ content: `${a} × ${b}`, type: 'expression' });
                answers.push({ content: result.toString(), type: 'answer' });
            }
        }

        // 合併算式和答案並隨機排列
        const cards = expressions.concat(answers);
        shuffle(cards);
        return cards;
    }

    // 將數組隨機排列
    function shuffle(array) {
        array.sort(() => Math.random() - 0.5);
    }

    // 初始化遊戲
    function initGame() {
        const cardsData = generateCards();

        cardsData.forEach(data => {
            const cardDiv = document.createElement('div');
            cardDiv.classList.add('card');
            cardDiv.textContent = data.content;
            cardDiv.dataset.type = data.type;
            cardDiv.dataset.value = data.content;
            cardDiv.addEventListener('click', () => selectCard(cardDiv));
            gameContainer.appendChild(cardDiv);
        });

        startTimer();
    }

    // 處理點擊事件
    function selectCard(card) {
        if (card.classList.contains('matched') || selectedCards.includes(card)) {
            return;
        }

        card.classList.add('selected');
        selectedCards.push(card);

        if (selectedCards.length === 2) {
            const [firstCard, secondCard] = selectedCards;
            const isMatch = checkMatch(firstCard, secondCard);

            if (isMatch) {
                playSound('correct');
                selectedCards.forEach(item => {
                    item.classList.add('matched');
                    item.classList.remove('selected');
                    item.textContent = '';
                });
                // 檢查是否遊戲結束
                if (document.querySelectorAll('.card:not(.matched)').length === 0) {
                    stopTimer();
                    const currentTime = parseInt(document.getElementById('time').textContent);
                    setTimeout(() => {
                        alert('恭喜！你完成了遊戲，總用時：' + currentTime + ' 秒');
                        // 更新最佳時間
                        if (bestTime === '--' || currentTime < bestTime) {
                            bestTime = currentTime;
                            localStorage.setItem('bestTime', bestTime);
                            document.getElementById('best').textContent = bestTime;
                            alert('新的最佳時間！');
                        }
                        // 重置遊戲
                        resetGame();
                    }, 500);
                }
            } else {
                playSound('wrong');
                setTimeout(() => {
                    selectedCards.forEach(item => {
                        item.classList.remove('selected');
                    });
                    selectedCards = [];
                }, 500);
                return;
            }
            selectedCards = [];
        }
    }

    // 判斷是否匹配
    function checkMatch(card1, card2) {
        const type1 = card1.dataset.type;
        const type2 = card2.dataset.type;
        const value1 = card1.dataset.value;
        const value2 = card2.dataset.value;

        if (type1 === type2) {
            return false; // 相同類型不匹配
        }

        let expression, answer;
        if (type1 === 'expression') {
            expression = value1;
            answer = parseInt(value2);
        } else {
            expression = value2;
            answer = parseInt(value1);
        }

        const [a, b] = expression.split('×').map(num => parseInt(num.trim()));
        return a * b === answer;
    }

    // 播放音效
    function playSound(type) {
        const sound = document.getElementById(type + '-sound');
        sound.currentTime = 0;
        sound.play();
    }

    // 計時器
    function startTimer() {
        startTime = Date.now();
        timerInterval = setInterval(() => {
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('time').textContent = elapsedTime;
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    // 重置遊戲
    function resetGame() {
        gameContainer.innerHTML = '';
        document.getElementById('time').textContent = '0';
        selectedCards = [];
        initGame();
    }

    initGame();
</script>

</body>
</html>
