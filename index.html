<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>九九乘法表配對遊戲</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
        }
        #game-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        #expressions, #answers {
            width: 300px;
            margin: 0 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #expressions .card, #answers .card {
            width: 200px;
            height: 50px;
            background-color: #87CEFA;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            cursor: pointer;
            border-radius: 5px;
            user-select: none;
            border: none;
            margin: 5px 0;
        }
        .matched {
            background-color: #32CD32;
            cursor: default;
            visibility: hidden;
        }
        #timer, #best-time {
            font-size: 24px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<h1>九九乘法表配對遊戲</h1>
<p>將左側的乘法算式與右側的正確答案配對。</p>
<div id="timer">時間：<span id="time">0</span> 秒</div>
<div id="best-time">最佳時間：<span id="best">--</span> 秒</div>
<div id="game-container">
    <div id="expressions"></div>
    <div id="answers"></div>
</div>

<!-- 音效檔案 -->
<audio id="correct-sound" src="correct.mp3"></audio>
<audio id="wrong-sound" src="wrong.mp3"></audio>

<script>
    let selectedCards = [];
    const expressionsContainer = document.getElementById('expressions');
    const answersContainer = document.getElementById('answers');
    let startTime, timerInterval;
    let bestTime = localStorage.getItem('bestTime') || '--';

    document.getElementById('best').textContent = bestTime;

    // 生成乘法算式與答案
    function generateCards() {
        const expressions = [];
        const answers = [];
        const usedPairs = new Set();

        while (expressions.length < 10) { // 總共需要10組配對
            const a = Math.floor(Math.random() * 9) + 1;
            const b = Math.floor(Math.random() * 9) + 1;
            const result = a * b;
            const pairKey = `${a}x${b}`;

            // 避免重複的算式
            if (!usedPairs.has(pairKey)) {
                usedPairs.add(pairKey);
                expressions.push(`${a} × ${b}`);
                answers.push(result);
            }
        }

        // 將算式和答案分開排列
        shuffle(expressions);
        shuffle(answers);
        return { expressions, answers };
    }

    // 將數組隨機排列
    function shuffle(array) {
        array.sort(() => Math.random() - 0.5);
    }

    // 初始化遊戲
    function initGame() {
        const { expressions, answers } = generateCards();

        expressions.forEach(content => {
            const cardButton = document.createElement('button');
            cardButton.classList.add('card');
            cardButton.textContent = content;
            cardButton.addEventListener('click', () => selectCard(cardButton, content, 'expression'));
            expressionsContainer.appendChild(cardButton);
        });

        answers.forEach(content => {
            const cardButton = document.createElement('button');
            cardButton.classList.add('card');
            cardButton.textContent = content;
            cardButton.addEventListener('click', () => selectCard(cardButton, content, 'answer'));
            answersContainer.appendChild(cardButton);
        });

        startTimer();
    }

    // 處理點擊事件
    function selectCard(element, content, type) {
        if (element.classList.contains('matched') || selectedCards.some(item => item.element === element)) {
            return;
        }

        element.style.backgroundColor = '#FFA500';
        selectedCards.push({ element, content, type });

        if (selectedCards.length === 2) {
            const first = selectedCards[0];
            const second = selectedCards[1];

            if (first.type !== second.type && isMatch(first.content, second.content)) {
                playSound('correct');
                selectedCards.forEach(item => {
                    item.element.classList.add('matched');
                    item.element.textContent = '';
                });
                // 檢查是否遊戲結束
                if (document.querySelectorAll('.card:not(.matched)').length === 0) {
                    stopTimer();
                    const currentTime = parseInt(document.getElementById('time').textContent);
                    setTimeout(() => {
                        alert('恭喜！你完成了遊戲，總用時：' + currentTime + ' 秒');
                        // 更新最佳時間
                        if (bestTime === '--' || currentTime < bestTime) {
                            bestTime = currentTime;
                            localStorage.setItem('bestTime', bestTime);
                            document.getElementById('best').textContent = bestTime;
                            alert('新的最佳時間！');
                        }
                        // 重置遊戲
                        resetGame();
                    }, 500);
                }
            } else {
                playSound('wrong');
                // 如果不匹配，恢復原狀
                setTimeout(() => {
                    selectedCards.forEach(item => {
                        item.element.style.backgroundColor = '#87CEFA';
                    });
                    selectedCards = [];
                }, 500);
                return;
            }
            selectedCards = [];
        }
    }

    // 判斷是否匹配
    function isMatch(content1, content2) {
        let expression, answer;
        if (content1.includes('×')) {
            expression = content1;
            answer = content2;
        } else if (content2.includes('×')) {
            expression = content2;
            answer = content1;
        } else {
            return false;
        }
        const [a, b] = expression.split('×').map(num => parseInt(num.trim()));
        return a * b === parseInt(answer);
    }

    // 播放音效
    function playSound(type) {
        const sound = document.getElementById(type + '-sound');
        sound.currentTime = 0;
        sound.play();
    }

    // 計時器
    function startTimer() {
        startTime = Date.now();
        timerInterval = setInterval(() => {
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('time').textContent = elapsedTime;
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    // 重置遊戲
    function resetGame() {
        expressionsContainer.innerHTML = '';
        answersContainer.innerHTML = '';
        document.getElementById('time').textContent = '0';
        selectedCards = [];
        initGame();
    }

    initGame();
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>九九乘法表配對遊戲</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        h1 {
            background-color: #4CAF50;
            color: white;
            padding: 20px 0;
            margin: 0;
        }

        p {
            font-size: 18px;
            margin: 10px 0;
        }

        #timer, #best-time {
            font-size: 20px;
            margin-top: 10px;
        }

        #game-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin-top: 20px;
            padding: 20px;
        }

        #expressions, #answers {
            width: 45%;
            margin: 0 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .card {
            width: 120px;
            height: 80px;
            background-color: #fff;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 10px;
            user-select: none;
            border: 2px solid #4CAF50;
            margin: 10px;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: scale(1.05);
            background-color: #e8f5e9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .matched {
            background-color: #A5D6A7;
            cursor: default;
            visibility: hidden;
        }

        /* 音效控制 */
        audio {
            display: none;
        }

        /* 手機響應式 */
        @media (max-width: 768px) {
            #game-container {
                flex-direction: column;
                align-items: center;
            }

            #expressions, #answers {
                width: 80%;
            }

            .card {
                width: 100px;
                height: 70px;
                margin: 8px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>

<h1>九九乘法表配對遊戲</h1>
<p>將左側的乘法算式與右側的正確答案配對。</p>
<div id="timer">時間：<span id="time">0</span> 秒</div>
<div id="best-time">最佳時間：<span id="best">--</span> 秒</div>
<div id="game-container">
    <div id="expressions"></div>
    <div id="answers"></div>
</div>

<!-- 音效檔案 -->
<audio id="correct-sound" src="correct.mp3"></audio>
<audio id="wrong-sound" src="wrong.mp3"></audio>

<script>
    let selectedCards = [];
    const expressionsContainer = document.getElementById('expressions');
    const answersContainer = document.getElementById('answers');
    let startTime, timerInterval;
    let bestTime = localStorage.getItem('bestTime') || '--';

    document.getElementById('best').textContent = bestTime;

    // 生成乘法算式與答案
    function generateCards() {
        const expressions = [];
        const answers = [];
        const usedPairs = new Set();
        const totalPairs = 20; // 增加配對組數

        while (expressions.length < totalPairs) {
            const a = Math.floor(Math.random() * 9) + 1;
            const b = Math.floor(Math.random() * 9) + 1;
            const result = a * b;
            const pairKey = `${a}x${b}`;

            // 避免重複的算式
            if (!usedPairs.has(pairKey)) {
                usedPairs.add(pairKey);
                expressions.push(`${a} × ${b}`);
                answers.push(result);
            }
        }

        // 將算式和答案分開排列
        shuffle(expressions);
        shuffle(answers);
        return { expressions, answers };
    }

    // 將數組隨機排列
    function shuffle(array) {
        array.sort(() => Math.random() - 0.5);
    }

    // 初始化遊戲
    function initGame() {
        const { expressions, answers } = generateCards();

        expressions.forEach(content => {
            const cardButton = document.createElement('div');
            cardButton.classList.add('card');
            cardButton.textContent = content;
            cardButton.addEventListener('click', () => selectCard(cardButton, content, 'expression'));
            expressionsContainer.appendChild(cardButton);
        });

        answers.forEach(content => {
            const cardButton = document.createElement('div');
            cardButton.classList.add('card');
            cardButton.textContent = content;
            cardButton.addEventListener('click', () => selectCard(cardButton, content, 'answer'));
            answersContainer.appendChild(cardButton);
        });

        startTimer();
    }

    // 處理點擊事件
    function selectCard(element, content, type) {
        if (element.classList.contains('matched') || selectedCards.some(item => item.element === element)) {
            return;
        }

        element.style.backgroundColor = '#FFECB3';
        selectedCards.push({ element, content, type });

        if (selectedCards.length === 2) {
            const first = selectedCards[0];
            const second = selectedCards[1];

            if (first.type !== second.type && isMatch(first.content, second.content)) {
                playSound('correct');
                selectedCards.forEach(item => {
                    item.element.classList.add('matched');
                    item.element.textContent = '';
                });
                // 檢查是否遊戲結束
                if (document.querySelectorAll('.card:not(.matched)').length === 0) {
                    stopTimer();
                    const currentTime = parseInt(document.getElementById('time').textContent);
                    setTimeout(() => {
                        alert('恭喜！你完成了遊戲，總用時：' + currentTime + ' 秒');
                        // 更新最佳時間
                        if (bestTime === '--' || currentTime < bestTime) {
                            bestTime = currentTime;
                            localStorage.setItem('bestTime', bestTime);
                            document.getElementById('best').textContent = bestTime;
                            alert('新的最佳時間！');
                        }
                        // 重置遊戲
                        resetGame();
                    }, 500);
                }
            } else {
                playSound('wrong');
                // 如果不匹配，恢復原狀
                setTimeout(() => {
                    selectedCards.forEach(item => {
                        item.element.style.backgroundColor = '#fff';
                    });
                    selectedCards = [];
                }, 500);
                return;
            }
            selectedCards = [];
        }
    }

    // 判斷是否匹配
    function isMatch(content1, content2) {
        let expression, answer;
        if (content1.includes('×')) {
            expression = content1;
            answer = content2;
        } else if (content2.includes('×')) {
            expression = content2;
            answer = content1;
        } else {
            return false;
        }
        const [a, b] = expression.split('×').map(num => parseInt(num.trim()));
        return a * b === parseInt(answer);
    }

    // 播放音效
    function playSound(type) {
        const sound = document.getElementById(type + '-sound');
        sound.currentTime = 0;
        sound.play();
    }

    // 計時器
    function startTimer() {
        startTime = Date.now();
        timerInterval = setInterval(() => {
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('time').textContent = elapsedTime;
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    // 重置遊戲
    function resetGame() {
        expressionsContainer.innerHTML = '';
        answersContainer.innerHTML = '';
        document.getElementById('time').textContent = '0';
        selectedCards = [];
        initGame();
    }

    initGame();
</script>

</body>
</html>
